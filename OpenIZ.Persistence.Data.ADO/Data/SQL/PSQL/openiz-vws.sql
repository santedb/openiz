/*
 * OPENIZ DATA VIEWS
 */

-- VIEW FOR CURRENT VERSIONS OF ENTITIES
CREATE OR REPLACE VIEW ENT_CUR_VRSN_VW AS
	SELECT * FROM ENT_VRSN_TBL INNER JOIN ENT_TBL USING (ENT_ID)
	WHERE OBSLT_UTC IS NULL;

-- VIEW FOR CURRENT VERSION OF PERSONS
CREATE OR REPLACE VIEW PSN_CUR_VRSN_VW AS
	SELECT * FROM ENT_CUR_VRSN_VW INNER JOIN PSN_TBL USING (ENT_VRSN_ID);
	
-- VIEW FOR CURRENT VERSION OF PATIENTS
CREATE OR REPLACE VIEW PAT_CUR_VRSN_VW AS 
	SELECT * FROM PSN_CUR_VRSN_VW INNER JOIN PAT_TBL USING (ENT_VRSN_ID);

-- VIEW FOR CURRENT VERSION OF PROVIDERS
CREATE OR REPLACE VIEW PVDR_CUR_VRSN_VW AS
	SELECT * FROM PSN_CUR_VRSN_VW INNER JOIN PVDR_TBL USING (ENT_VRSN_ID);

-- VIEW FOR CURRENT VERSION OF MATERIALS
CREATE OR REPLACE VIEW MAT_CUR_VRSN_VW AS 
	SELECT * FROM ENT_CUR_VRSN_VW INNER JOIN MAT_TBL USING (ENT_VRSN_ID);

-- VIEW FOR CURRENT VERSION OF MANUFACTURED MATERIALS
CREATE OR REPLACE VIEW MMAT_CUR_VRSN_VW AS
	SELECT * FROM MAT_CUR_VRSN_VW INNER JOIN MMAT_TBL USING (ENT_VRSN_ID);

-- VIEW FOR CURRENT VERSION OF PLACES
CREATE OR REPLACE VIEW PLC_CUR_VRSN_VW AS
	SELECT * FROM ENT_CUR_VRSN_VW INNER JOIN PLC_TBL USING (ENT_VRSN_ID);

-- VIEW FOR CURRENT VERSION OF USERS
CREATE OR REPLACE VIEW USR_CUR_VRSN_VW AS
	SELECT PSN_CUR_VRSN_VW.*, SEC_USR_TBL.USR_NAME 
		FROM PSN_CUR_VRSN_VW INNER JOIN USR_ENT_TBL USING (ENT_VRSN_ID)
		INNER JOIN SEC_USR_TBL ON (USR_ID = SEC_USR_ID);
	